{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\nimport { SDK_CDN_URL } from \"./constants\";\n\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\n\nexport class RelayerSDKLoader {\n  private _trace?: TraceType;\n\n  constructor(options: { trace?: TraceType }) {\n    this._trace = options.trace;\n  }\n\n  public isLoaded() {\n    if (typeof window === \"undefined\") {\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\n    }\n    return isFhevmWindowType(window, this._trace);\n  }\n\n  public load(): Promise<void> {\n    console.log(\"[RelayerSDKLoader] load...\");\n    if (typeof window === \"undefined\") {\n      console.log(\"[RelayerSDKLoader] window === undefined\");\n      return Promise.reject(\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\n      );\n    }\n\n    if (\"relayerSDK\" in window) {\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\n      }\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const existingScript = document.querySelector(\n        `script[src=\"${SDK_CDN_URL}\"]`\n      );\n      if (existingScript) {\n        if (!isFhevmWindowType(window, this._trace)) {\n          reject(\n            new Error(\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\n            )\n          );\n        }\n        resolve();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = SDK_CDN_URL;\n      script.type = \"text/javascript\";\n      script.async = true;\n\n      script.onload = () => {\n        if (!isFhevmWindowType(window, this._trace)) {\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\n          reject(\n            new Error(\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\n            )\n          );\n        }\n        resolve();\n      };\n\n      script.onerror = () => {\n        console.log(\"[RelayerSDKLoader] script onerror... \");\n        reject(\n          new Error(\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\n          )\n        );\n      };\n\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\n      document.head.appendChild(script);\n      console.log(\"[RelayerSDKLoader] script added!\")\n    });\n  }\n}\n\nfunction isFhevmRelayerSDKType(\n  o: unknown,\n  trace?: TraceType\n): o is FhevmRelayerSDKType {\n  if (typeof o === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\n    return false;\n  }\n  if (o === null) {\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\n    return false;\n  }\n  if (typeof o !== \"object\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\n    return false;\n  }\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\n    return false;\n  }\n  if (\"__initialized__\" in o) {\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isFhevmWindowType(\n  win: unknown,\n  trace?: TraceType\n): win is FhevmWindowType {\n  if (typeof win === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\n    return false;\n  }\n  if (win === null) {\n    trace?.(\"RelayerSDKLoader: window object is null\");\n    return false;\n  }\n  if (typeof win !== \"object\") {\n    trace?.(\"RelayerSDKLoader: window is not an object\");\n    return false;\n  }\n  if (!(\"relayerSDK\" in win)) {\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\n    return false;\n  }\n  return isFhevmRelayerSDKType(win.relayerSDK);\n}\n\nfunction objHasProperty<\n  T extends object,\n  K extends PropertyKey,\n  V extends string\n>(\n  obj: T,\n  propertyName: K,\n  propertyType: V,\n  trace?: TraceType\n): obj is T &\n  Record<\n    K,\n    V extends \"string\"\n      ? string\n      : V extends \"number\"\n      ? number\n      : V extends \"object\"\n      ? object\n      : V extends \"boolean\"\n      ? boolean\n      : V extends \"function\"\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (...args: any[]) => any\n      : unknown\n  > {\n  if (!obj || typeof obj !== \"object\") {\n    return false;\n  }\n\n  if (!(propertyName in obj)) {\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\n    return false;\n  }\n\n  const value = (obj as Record<K, unknown>)[propertyName];\n\n  if (value === null || value === undefined) {\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\n    return false;\n  }\n\n  if (typeof value !== propertyType) {\n    trace?.(\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\n    );\n    return false;\n  }\n\n  return true;\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\n\ntype FhevmStoredPublicKey = {\n  publicKeyId: string;\n  publicKey: Uint8Array;\n};\n\ntype FhevmStoredPublicParams = {\n  publicParamsId: string;\n  publicParams: Uint8Array;\n};\n\ninterface PublicParamsDB extends DBSchema {\n  publicKeyStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicKey;\n    };\n  };\n  paramsStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicParams;\n    };\n  };\n}\n\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\n\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\n  if (__dbPromise) {\n    return __dbPromise;\n  }\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\n      }\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\n      }\n    },\n  });\n  return __dbPromise;\n}\n\ntype FhevmInstanceConfigPublicKey = {\n  data: Uint8Array | null;\n  id: string | null;\n};\n\ntype FhevmInstanceConfigPublicParams = {\n  \"2048\": {\n    publicParamsId: string;\n    publicParams: Uint8Array;\n  };\n};\n\nfunction assertFhevmStoredPublicKey(\n  value: unknown\n): asserts value is FhevmStoredPublicKey | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicKey must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicKeyId\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\n  }\n  if (typeof value.publicKeyId !== \"string\") {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\n  }\n  if (!(\"publicKey\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\n  }\n  if (!(value.publicKey instanceof Uint8Array)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\n  }\n}\n\nfunction assertFhevmStoredPublicParams(\n  value: unknown\n): asserts value is FhevmStoredPublicParams | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicParams must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicParamsId\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\n  }\n  if (typeof value.publicParamsId !== \"string\") {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\n  }\n  if (!(\"publicParams\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\n  }\n  if (!(value.publicParams instanceof Uint8Array)) {\n    throw new Error(\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\n    );\n  }\n}\n\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\n  publicKey?: FhevmInstanceConfigPublicKey;\n  publicParams: FhevmInstanceConfigPublicParams | null;\n}> {\n  const db = await _getDB();\n  if (!db) {\n    return { publicParams: null };\n  }\n\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\n  try {\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\n    if (pk?.value) {\n      assertFhevmStoredPublicKey(pk.value);\n      storedPublicKey = pk.value;\n    }\n  } catch {\n    //\n  }\n\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\n  try {\n    const pp = await db.get(\"paramsStore\", aclAddress);\n    if (pp?.value) {\n      assertFhevmStoredPublicParams(pp.value);\n      storedPublicParams = pp.value;\n    }\n  } catch {\n    //\n  }\n\n  const publicKeyData = storedPublicKey?.publicKey;\n  const publicKeyId = storedPublicKey?.publicKeyId;\n  const publicParams = storedPublicParams\n    ? {\n        \"2048\": storedPublicParams,\n      }\n    : null;\n\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\n\n  if (publicKeyId && publicKeyData) {\n    publicKey = {\n      id: publicKeyId,\n      data: publicKeyData,\n    };\n  }\n\n  return {\n    ...(publicKey !== undefined && { publicKey }),\n    publicParams,\n  };\n}\n\nexport async function publicKeyStorageSet(\n  aclAddress: `0x${string}`,\n  publicKey: FhevmStoredPublicKey | null,\n  publicParams: FhevmStoredPublicParams | null\n) {\n  assertFhevmStoredPublicKey(publicKey);\n  assertFhevmStoredPublicParams(publicParams);\n\n  const db = await _getDB();\n  if (!db) {\n    return;\n  }\n\n  if (publicKey) {\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\n  }\n\n  if (publicParams) {\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 299, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\nimport type {\n  FhevmInitSDKOptions,\n  FhevmInitSDKType,\n  FhevmLoadSDKType,\n  FhevmWindowType,\n} from \"./fhevmTypes\";\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\n\nexport class FhevmReactError extends Error {\n  code: string;\n  constructor(code: string, message?: string, options?: ErrorOptions) {\n    super(message, options);\n    this.code = code;\n    this.name = \"FhevmReactError\";\n  }\n}\n\nfunction throwFhevmError(\n  code: string,\n  message?: string,\n  cause?: unknown\n): never {\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\n}\n\nconst isFhevmInitialized = (): boolean => {\n  if (!isFhevmWindowType(window, console.log)) {\n    return false;\n  }\n  return window.relayerSDK.__initialized__ === true;\n};\n\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\n  const loader = new RelayerSDKLoader({ trace: console.log });\n  return loader.load();\n};\n\nconst fhevmInitSDK: FhevmInitSDKType = async (\n  options?: FhevmInitSDKOptions\n) => {\n  if (!isFhevmWindowType(window, console.log)) {\n    throw new Error(\"window.relayerSDK is not available\");\n  }\n  const result = await window.relayerSDK.initSDK(options);\n  window.relayerSDK.__initialized__ = result;\n  if (!result) {\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\n  }\n  return true;\n};\n\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\n  if (typeof a !== \"string\") {\n    return false;\n  }\n  if (!isAddress(a)) {\n    return false;\n  }\n  return true;\n}\n\nexport class FhevmAbortError extends Error {\n  constructor(message = \"FHEVM operation was cancelled\") {\n    super(message);\n    this.name = \"FhevmAbortError\";\n  }\n}\n\ntype FhevmRelayerStatusType =\n  | \"sdk-loading\"\n  | \"sdk-loaded\"\n  | \"sdk-initializing\"\n  | \"sdk-initialized\"\n  | \"creating\";\n\nasync function getChainId(\n  providerOrUrl: Eip1193Provider | string\n): Promise<number> {\n  try {\n    if (typeof providerOrUrl === \"string\") {\n      const provider = new JsonRpcProvider(providerOrUrl, undefined, {\n        staticNetwork: true,\n      });\n      // Add timeout and better error handling\n      const network = await Promise.race([\n        provider.getNetwork(),\n        new Promise<never>((_, reject) =>\n          setTimeout(() => reject(new Error(\"Network request timeout\")), 10000)\n        ),\n      ]);\n      provider.destroy();\n      return Number(network.chainId);\n    }\n    // For EIP1193 provider, add timeout\n    const chainId = await Promise.race([\n      providerOrUrl.request({ method: \"eth_chainId\" }),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(\"Provider request timeout\")), 10000)\n      ),\n    ]);\n    return Number.parseInt(chainId as string, 16);\n  } catch (error: any) {\n    const errorMessage = error?.message || String(error);\n    // Completely suppress \"Failed to fetch\" errors - they're non-fatal\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\n      // Silently return a default chainId for string URLs, or throw a non-fetch error for providers\n      if (typeof providerOrUrl === \"string\") {\n        // For string URLs, try to infer from URL\n        if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\n          return 31337; // Assume localhost is Hardhat\n        }\n        // Can't determine, but don't throw - let caller handle\n        throw new Error(\"CHAIN_ID_UNAVAILABLE\");\n      }\n      // For EIP1193 providers, we need chainId, but don't throw fetch error\n      throw new Error(\"CHAIN_ID_UNAVAILABLE\");\n    }\n    throw error;\n  }\n}\n\nasync function getWeb3Client(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl, undefined, {\n    staticNetwork: true,\n  });\n  try {\n    // Add timeout to prevent hanging\n    const version = await Promise.race([\n      rpc.send(\"web3_clientVersion\", []),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(\"RPC request timeout\")), 10000)\n      ),\n    ]);\n    return version;\n  } catch (e: any) {\n    // Don't throw error - let caller handle it gracefully\n    // This is expected if the node is not running or not accessible\n    throw e;\n  } finally {\n    rpc.destroy();\n  }\n}\n\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\n  | {\n      ACLAddress: `0x${string}`;\n      InputVerifierAddress: `0x${string}`;\n      KMSVerifierAddress: `0x${string}`;\n    }\n  | undefined\n> {\n  try {\n    const version = await getWeb3Client(rpcUrl);\n    if (\n      typeof version !== \"string\" ||\n      !version.toLowerCase().includes(\"hardhat\")\n    ) {\n      // Not a Hardhat Node - this is normal, not an error\n      return undefined;\n    }\n  } catch (e: any) {\n    // Failed to connect - this is expected if node is not running\n    // Silently return undefined instead of throwing\n    console.debug(`[FHEVM] Could not connect to ${rpcUrl} - this is normal if using a different network or if the node is not running`);\n    return undefined;\n  }\n\n  try {\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\n    if (!metadata || typeof metadata !== \"object\") {\n      return undefined;\n    }\n    if (\n      !(\n        \"ACLAddress\" in metadata &&\n        typeof metadata.ACLAddress === \"string\" &&\n        metadata.ACLAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"InputVerifierAddress\" in metadata &&\n        typeof metadata.InputVerifierAddress === \"string\" &&\n        metadata.InputVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"KMSVerifierAddress\" in metadata &&\n        typeof metadata.KMSVerifierAddress === \"string\" &&\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    return metadata;\n  } catch (e: any) {\n    // Not a FHEVM Hardhat Node or connection failed - this is normal\n    // Silently return undefined instead of throwing\n    const errorMsg = e?.message || String(e);\n    if (errorMsg.includes(\"Failed to fetch\") || errorMsg.includes(\"fetch\")) {\n      console.debug(`[FHEVM] Could not fetch relayer metadata from ${rpcUrl} - this is normal if not using FHEVM Hardhat node`);\n    } else {\n      console.debug(`[FHEVM] Relayer metadata not available from ${rpcUrl} - this is normal`);\n    }\n    return undefined;\n  }\n}\n\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl, undefined, {\n    staticNetwork: true,\n  });\n  try {\n    // Add timeout to prevent hanging\n    const version = await Promise.race([\n      rpc.send(\"fhevm_relayer_metadata\", []),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(\"RPC request timeout\")), 10000)\n      ),\n    ]);\n    return version;\n  } catch (e: any) {\n    // Don't throw error - let caller handle it gracefully\n    // This is expected if the node doesn't support FHEVM\n    throw e;\n  } finally {\n    rpc.destroy();\n  }\n}\n\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\ntype ResolveResult = MockResolveResult | GenericResolveResult;\n\nasync function resolve(\n  providerOrUrl: Eip1193Provider | string,\n  mockChains?: Record<number, string>\n): Promise<ResolveResult> {\n  try {\n    const chainId = await getChainId(providerOrUrl);\n    let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n\n    const _mockChains: Record<number, string> = {\n      31337: \"http://localhost:8545\",\n      ...(mockChains ?? {}),\n    };\n\n    if (Object.hasOwn(_mockChains, chainId)) {\n      if (!rpcUrl) {\n        rpcUrl = _mockChains[chainId];\n      }\n      return { isMock: true, chainId, rpcUrl };\n    }\n\n    return { isMock: false, chainId, rpcUrl };\n  } catch (error: any) {\n    // If we can't get chainId, but providerOrUrl is a string (RPC URL),\n    // we can still try to use it as a mock chain if it matches\n    if (typeof providerOrUrl === \"string\") {\n      const _mockChains: Record<number, string> = {\n        31337: \"http://localhost:8545\",\n        ...(mockChains ?? {}),\n      };\n      \n      // Check if the URL matches any mock chain\n      for (const [chainId, url] of Object.entries(_mockChains)) {\n        if (providerOrUrl === url || providerOrUrl.includes(url.replace(\"http://\", \"\").replace(\"https://\", \"\"))) {\n          console.debug(`[FHEVM] Using mock chain ${chainId} for ${providerOrUrl} (chainId fetch failed but URL matches)`);\n          return { isMock: true, chainId: Number(chainId), rpcUrl: providerOrUrl };\n        }\n      }\n      \n      // If it's a localhost URL, assume it's mock chain 31337\n      if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\n        console.debug(`[FHEVM] Assuming localhost URL ${providerOrUrl} is mock chain 31337`);\n        return { isMock: true, chainId: 31337, rpcUrl: providerOrUrl };\n      }\n    }\n    \n    // Completely suppress \"Failed to fetch\" errors\n    const errorMessage = error?.message || String(error);\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\") || errorMessage === \"CHAIN_ID_UNAVAILABLE\") {\n      // For string URLs, try to infer from URL pattern\n      if (typeof providerOrUrl === \"string\") {\n        const _mockChains: Record<number, string> = {\n          31337: \"http://localhost:8545\",\n          ...(mockChains ?? {}),\n        };\n        \n        // Check if the URL matches any mock chain\n        for (const [chainId, url] of Object.entries(_mockChains)) {\n          if (providerOrUrl === url || providerOrUrl.includes(url.replace(\"http://\", \"\").replace(\"https://\", \"\"))) {\n            return { isMock: true, chainId: Number(chainId), rpcUrl: providerOrUrl };\n          }\n        }\n        \n        // If it's a localhost URL, assume it's mock chain 31337\n        if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\n          return { isMock: true, chainId: 31337, rpcUrl: providerOrUrl };\n        }\n      }\n      \n      // For EIP1193 providers, can't determine chainId, return as non-mock\n      // This is fine - the instance will work without mock mode\n      return { isMock: false, chainId: 0, rpcUrl: undefined };\n    }\n    throw error;\n  }\n}\n\nexport const createFhevmInstance = async (parameters: {\n  provider: Eip1193Provider | string;\n  mockChains?: Record<number, string>;\n  signal: AbortSignal;\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\n}): Promise<FhevmInstance> => {\n  const throwIfAborted = () => {\n    if (signal.aborted) throw new FhevmAbortError();\n  };\n\n  const notify = (status: FhevmRelayerStatusType) => {\n    if (onStatusChange) onStatusChange(status);\n  };\n\n  const {\n    signal,\n    onStatusChange,\n    provider: providerOrUrl,\n    mockChains,\n  } = parameters;\n\n  let isMock: boolean;\n  let rpcUrl: string | undefined;\n  let chainId: number;\n  \n  try {\n    const resolved = await resolve(providerOrUrl, mockChains);\n    isMock = resolved.isMock;\n    rpcUrl = resolved.rpcUrl;\n    chainId = resolved.chainId;\n  } catch (error: any) {\n    // Completely suppress \"Failed to fetch\" errors in resolve\n    const errorMessage = error?.message || String(error);\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\n      // Fallback: assume non-mock mode\n      isMock = false;\n      rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n      chainId = 0;\n    } else {\n      throw error;\n    }\n  }\n\n  if (isMock) {\n    const fhevmRelayerMetadata =\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\n\n    if (fhevmRelayerMetadata) {\n      notify(\"creating\");\n      const fhevmMock = await import(\"./mock/fhevmMock\");\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\n        rpcUrl,\n        chainId,\n        metadata: fhevmRelayerMetadata,\n      });\n\n      throwIfAborted();\n      return mockInstance;\n    }\n  }\n\n  throwIfAborted();\n\n  if (!isFhevmWindowType(window, console.log)) {\n    notify(\"sdk-loading\");\n    await fhevmLoadSDK();\n    throwIfAborted();\n    notify(\"sdk-loaded\");\n  }\n\n  if (!isFhevmInitialized()) {\n    notify(\"sdk-initializing\");\n    await fhevmInitSDK();\n    throwIfAborted();\n    notify(\"sdk-initialized\");\n  }\n\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\n\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\n  if (!checkIsAddress(aclAddress)) {\n    throw new Error(`Invalid address: ${aclAddress}`);\n  }\n\n  const pub = await publicKeyStorageGet(aclAddress);\n  throwIfAborted();\n\n  const config: FhevmInstanceConfig = {\n    ...relayerSDK.SepoliaConfig,\n    network: providerOrUrl,\n    publicKey: pub.publicKey,\n    publicParams: pub.publicParams,\n  };\n\n  notify(\"creating\");\n\n  const instance = await relayerSDK.createInstance(config);\n\n  await publicKeyStorageSet(\n    aclAddress,\n    instance.getPublicKey(),\n    instance.getPublicParams(2048)\n  );\n\n  throwIfAborted();\n\n  return instance;\n};\n\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAAA;AAOA;AACA;;;;;AAGO,MAAM,wBAAwB;IAEnC,YAAY,IAAY,EAAE,OAAgB,EAAE,OAAsB,CAAE;QAClE,KAAK,CAAC,SAAS,UAFjB,2LAAA,QAAA,KAAA;QAGE,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEA,SAAS,gBACP,IAAY,EACZ,OAAgB,EAChB,KAAe;IAEf,MAAM,IAAI,gBAAgB,MAAM,SAAS,QAAQ;QAAE;IAAM,IAAI;AAC/D;AAEA,MAAM,qBAAqB;IACzB,IAAI,CAAC,IAAA,yKAAiB,EAAC,QAAQ,QAAQ,GAAG,GAAG;QAC3C,OAAO;IACT;IACA,OAAO,OAAO,UAAU,CAAC,eAAe,KAAK;AAC/C;AAEA,MAAM,eAAiC;IACrC,MAAM,SAAS,IAAI,wKAAgB,CAAC;QAAE,OAAO,QAAQ,GAAG;IAAC;IACzD,OAAO,OAAO,IAAI;AACpB;AAEA,MAAM,eAAiC,OACrC;IAEA,IAAI,CAAC,IAAA,yKAAiB,EAAC,QAAQ,QAAQ,GAAG,GAAG;QAC3C,MAAM,IAAI,MAAM;IAClB;IACA,MAAM,SAAS,MAAM,OAAO,UAAU,CAAC,OAAO,CAAC;IAC/C,OAAO,UAAU,CAAC,eAAe,GAAG;IACpC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEA,SAAS,eAAe,CAAU;IAChC,IAAI,OAAO,MAAM,UAAU;QACzB,OAAO;IACT;IACA,IAAI,CAAC,IAAA,qLAAS,EAAC,IAAI;QACjB,OAAO;IACT;IACA,OAAO;AACT;AAEO,MAAM,wBAAwB;IACnC,YAAY,UAAU,+BAA+B,CAAE;QACrD,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AASA,eAAe,WACb,aAAuC;IAEvC,IAAI;QACF,IAAI,OAAO,kBAAkB,UAAU;YACrC,MAAM,WAAW,IAAI,0MAAe,CAAC,eAAe,WAAW;gBAC7D,eAAe;YACjB;YACA,wCAAwC;YACxC,MAAM,UAAU,MAAM,QAAQ,IAAI,CAAC;gBACjC,SAAS,UAAU;gBACnB,IAAI,QAAe,CAAC,GAAG,SACrB,WAAW,IAAM,OAAO,IAAI,MAAM,6BAA6B;aAElE;YACD,SAAS,OAAO;YAChB,OAAO,OAAO,QAAQ,OAAO;QAC/B;QACA,oCAAoC;QACpC,MAAM,UAAU,MAAM,QAAQ,IAAI,CAAC;YACjC,cAAc,OAAO,CAAC;gBAAE,QAAQ;YAAc;YAC9C,IAAI,QAAe,CAAC,GAAG,SACrB,WAAW,IAAM,OAAO,IAAI,MAAM,8BAA8B;SAEnE;QACD,OAAO,OAAO,QAAQ,CAAC,SAAmB;IAC5C,EAAE,OAAO,OAAY;QACnB,MAAM,eAAe,CAAA,kBAAA,4BAAA,MAAO,OAAO,KAAI,OAAO;QAC9C,mEAAmE;QACnE,IAAI,aAAa,QAAQ,CAAC,sBAAsB,aAAa,QAAQ,CAAC,UAAU;YAC9E,8FAA8F;YAC9F,IAAI,OAAO,kBAAkB,UAAU;gBACrC,yCAAyC;gBACzC,IAAI,cAAc,QAAQ,CAAC,gBAAgB,cAAc,QAAQ,CAAC,cAAc;oBAC9E,OAAO,OAAO,8BAA8B;gBAC9C;gBACA,uDAAuD;gBACvD,MAAM,IAAI,MAAM;YAClB;YACA,sEAAsE;YACtE,MAAM,IAAI,MAAM;QAClB;QACA,MAAM;IACR;AACF;AAEA,eAAe,cAAc,MAAc;IACzC,MAAM,MAAM,IAAI,0MAAe,CAAC,QAAQ,WAAW;QACjD,eAAe;IACjB;IACA,IAAI;QACF,iCAAiC;QACjC,MAAM,UAAU,MAAM,QAAQ,IAAI,CAAC;YACjC,IAAI,IAAI,CAAC,sBAAsB,EAAE;YACjC,IAAI,QAAe,CAAC,GAAG,SACrB,WAAW,IAAM,OAAO,IAAI,MAAM,yBAAyB;SAE9D;QACD,OAAO;IACT,EAAE,OAAO,GAAQ;QACf,sDAAsD;QACtD,gEAAgE;QAChE,MAAM;IACR,SAAU;QACR,IAAI,OAAO;IACb;AACF;AAEA,eAAe,wCAAwC,MAAc;IAQnE,IAAI;QACF,MAAM,UAAU,MAAM,cAAc;QACpC,IACE,OAAO,YAAY,YACnB,CAAC,QAAQ,WAAW,GAAG,QAAQ,CAAC,YAChC;YACA,oDAAoD;YACpD,OAAO;QACT;IACF,EAAE,OAAO,GAAQ;QACf,8DAA8D;QAC9D,gDAAgD;QAChD,QAAQ,KAAK,CAAC,AAAC,gCAAsC,OAAP,QAAO;QACrD,OAAO;IACT;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,wBAAwB;QAC/C,IAAI,CAAC,YAAY,OAAO,aAAa,UAAU;YAC7C,OAAO;QACT;QACA,IACE,CAAC,CACC,gBAAgB,YAChB,OAAO,SAAS,UAAU,KAAK,YAC/B,SAAS,UAAU,CAAC,UAAU,CAAC,KACjC,GACA;YACA,OAAO;QACT;QACA,IACE,CAAC,CACC,0BAA0B,YAC1B,OAAO,SAAS,oBAAoB,KAAK,YACzC,SAAS,oBAAoB,CAAC,UAAU,CAAC,KAC3C,GACA;YACA,OAAO;QACT;QACA,IACE,CAAC,CACC,wBAAwB,YACxB,OAAO,SAAS,kBAAkB,KAAK,YACvC,SAAS,kBAAkB,CAAC,UAAU,CAAC,KACzC,GACA;YACA,OAAO;QACT;QACA,OAAO;IACT,EAAE,OAAO,GAAQ;QACf,iEAAiE;QACjE,gDAAgD;QAChD,MAAM,WAAW,CAAA,cAAA,wBAAA,EAAG,OAAO,KAAI,OAAO;QACtC,IAAI,SAAS,QAAQ,CAAC,sBAAsB,SAAS,QAAQ,CAAC,UAAU;YACtE,QAAQ,KAAK,CAAC,AAAC,iDAAuD,OAAP,QAAO;QACxE,OAAO;YACL,QAAQ,KAAK,CAAC,AAAC,+CAAqD,OAAP,QAAO;QACtE;QACA,OAAO;IACT;AACF;AAEA,eAAe,wBAAwB,MAAc;IACnD,MAAM,MAAM,IAAI,0MAAe,CAAC,QAAQ,WAAW;QACjD,eAAe;IACjB;IACA,IAAI;QACF,iCAAiC;QACjC,MAAM,UAAU,MAAM,QAAQ,IAAI,CAAC;YACjC,IAAI,IAAI,CAAC,0BAA0B,EAAE;YACrC,IAAI,QAAe,CAAC,GAAG,SACrB,WAAW,IAAM,OAAO,IAAI,MAAM,yBAAyB;SAE9D;QACD,OAAO;IACT,EAAE,OAAO,GAAQ;QACf,sDAAsD;QACtD,qDAAqD;QACrD,MAAM;IACR,SAAU;QACR,IAAI,OAAO;IACb;AACF;AAMA,eAAe,QACb,aAAuC,EACvC,UAAmC;IAEnC,IAAI;QACF,MAAM,UAAU,MAAM,WAAW;QACjC,IAAI,SAAS,OAAO,kBAAkB,WAAW,gBAAgB;QAEjE,MAAM,cAAsC;YAC1C,OAAO;YACP,GAAI,uBAAA,wBAAA,aAAc,CAAC,CAAC;QACtB;QAEA,IAAI,OAAO,MAAM,CAAC,aAAa,UAAU;YACvC,IAAI,CAAC,QAAQ;gBACX,SAAS,WAAW,CAAC,QAAQ;YAC/B;YACA,OAAO;gBAAE,QAAQ;gBAAM;gBAAS;YAAO;QACzC;QAEA,OAAO;YAAE,QAAQ;YAAO;YAAS;QAAO;IAC1C,EAAE,OAAO,OAAY;QACnB,oEAAoE;QACpE,2DAA2D;QAC3D,IAAI,OAAO,kBAAkB,UAAU;YACrC,MAAM,cAAsC;gBAC1C,OAAO;gBACP,GAAI,uBAAA,wBAAA,aAAc,CAAC,CAAC;YACtB;YAEA,0CAA0C;YAC1C,KAAK,MAAM,CAAC,SAAS,IAAI,IAAI,OAAO,OAAO,CAAC,aAAc;gBACxD,IAAI,kBAAkB,OAAO,cAAc,QAAQ,CAAC,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,YAAY,MAAM;oBACvG,QAAQ,KAAK,CAAC,AAAC,4BAA0C,OAAf,SAAQ,SAAqB,OAAd,eAAc;oBACvE,OAAO;wBAAE,QAAQ;wBAAM,SAAS,OAAO;wBAAU,QAAQ;oBAAc;gBACzE;YACF;YAEA,wDAAwD;YACxD,IAAI,cAAc,QAAQ,CAAC,gBAAgB,cAAc,QAAQ,CAAC,cAAc;gBAC9E,QAAQ,KAAK,CAAC,AAAC,kCAA+C,OAAd,eAAc;gBAC9D,OAAO;oBAAE,QAAQ;oBAAM,SAAS;oBAAO,QAAQ;gBAAc;YAC/D;QACF;QAEA,+CAA+C;QAC/C,MAAM,eAAe,CAAA,kBAAA,4BAAA,MAAO,OAAO,KAAI,OAAO;QAC9C,IAAI,aAAa,QAAQ,CAAC,sBAAsB,aAAa,QAAQ,CAAC,YAAY,iBAAiB,wBAAwB;YACzH,iDAAiD;YACjD,IAAI,OAAO,kBAAkB,UAAU;gBACrC,MAAM,cAAsC;oBAC1C,OAAO;oBACP,GAAI,uBAAA,wBAAA,aAAc,CAAC,CAAC;gBACtB;gBAEA,0CAA0C;gBAC1C,KAAK,MAAM,CAAC,SAAS,IAAI,IAAI,OAAO,OAAO,CAAC,aAAc;oBACxD,IAAI,kBAAkB,OAAO,cAAc,QAAQ,CAAC,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,YAAY,MAAM;wBACvG,OAAO;4BAAE,QAAQ;4BAAM,SAAS,OAAO;4BAAU,QAAQ;wBAAc;oBACzE;gBACF;gBAEA,wDAAwD;gBACxD,IAAI,cAAc,QAAQ,CAAC,gBAAgB,cAAc,QAAQ,CAAC,cAAc;oBAC9E,OAAO;wBAAE,QAAQ;wBAAM,SAAS;wBAAO,QAAQ;oBAAc;gBAC/D;YACF;YAEA,qEAAqE;YACrE,0DAA0D;YAC1D,OAAO;gBAAE,QAAQ;gBAAO,SAAS;gBAAG,QAAQ;YAAU;QACxD;QACA,MAAM;IACR;AACF;AAEO,MAAM,sBAAsB,OAAO;IAMxC,MAAM,iBAAiB;QACrB,IAAI,OAAO,OAAO,EAAE,MAAM,IAAI;IAChC;IAEA,MAAM,SAAS,CAAC;QACd,IAAI,gBAAgB,eAAe;IACrC;IAEA,MAAM,EACJ,MAAM,EACN,cAAc,EACd,UAAU,aAAa,EACvB,UAAU,EACX,GAAG;IAEJ,IAAI;IACJ,IAAI;IACJ,IAAI;IAEJ,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,eAAe;QAC9C,SAAS,SAAS,MAAM;QACxB,SAAS,SAAS,MAAM;QACxB,UAAU,SAAS,OAAO;IAC5B,EAAE,OAAO,OAAY;QACnB,0DAA0D;QAC1D,MAAM,eAAe,CAAA,kBAAA,4BAAA,MAAO,OAAO,KAAI,OAAO;QAC9C,IAAI,aAAa,QAAQ,CAAC,sBAAsB,aAAa,QAAQ,CAAC,UAAU;YAC9E,iCAAiC;YACjC,SAAS;YACT,SAAS,OAAO,kBAAkB,WAAW,gBAAgB;YAC7D,UAAU;QACZ,OAAO;YACL,MAAM;QACR;IACF;IAEA,IAAI,QAAQ;QACV,MAAM,uBACJ,MAAM,wCAAwC;QAEhD,IAAI,sBAAsB;YACxB,OAAO;YACP,MAAM,YAAY;YAClB,MAAM,eAAe,MAAM,UAAU,uBAAuB,CAAC;gBAC3D;gBACA;gBACA,UAAU;YACZ;YAEA;YACA,OAAO;QACT;IACF;IAEA;IAEA,IAAI,CAAC,IAAA,yKAAiB,EAAC,QAAQ,QAAQ,GAAG,GAAG;QAC3C,OAAO;QACP,MAAM;QACN;QACA,OAAO;IACT;IAEA,IAAI,CAAC,sBAAsB;QACzB,OAAO;QACP,MAAM;QACN;QACA,OAAO;IACT;IAEA,MAAM,aAAa,AAAC,OAAsC,UAAU;IAEpE,MAAM,aAAa,WAAW,aAAa,CAAC,kBAAkB;IAC9D,IAAI,CAAC,eAAe,aAAa;QAC/B,MAAM,IAAI,MAAM,AAAC,oBAA8B,OAAX;IACtC;IAEA,MAAM,MAAM,MAAM,IAAA,2KAAmB,EAAC;IACtC;IAEA,MAAM,SAA8B;QAClC,GAAG,WAAW,aAAa;QAC3B,SAAS;QACT,WAAW,IAAI,SAAS;QACxB,cAAc,IAAI,YAAY;IAChC;IAEA,OAAO;IAEP,MAAM,WAAW,MAAM,WAAW,cAAc,CAAC;IAEjD,MAAM,IAAA,2KAAmB,EACvB,YACA,SAAS,YAAY,IACrB,SAAS,eAAe,CAAC;IAG3B;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 657, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;  \n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    if (_abortControllerRef.current) {\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      _setProviderChanged((prev) => prev + 1);\n    }\n  }, [provider, chainId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  useEffect(() => {\n      if (_isRunning === false) {\n        // Suppress cancelled log - this is normal behavior\n        if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          if (thisSignal.aborted) {\n            return;\n          }\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          // Completely suppress \"Failed to fetch\" errors - they're non-fatal\n          const errorMessage = e?.message || String(e);\n          if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\n            // Silently ignore - this is expected when RPC is not available\n            // The instance will work in non-mock mode or retry later\n            _setInstance(undefined);\n            _setError(undefined);\n            _setStatus(\"idle\");\n            return;\n          }\n\n          // Only log and set error for non-fetch errors\n          console.error(`[useFhevm] Error creating FHEVM instance:`, e);\n          const enhancedError = new Error(errorMessage);\n          enhancedError.name = e.name || \"FHEVMInitializationError\";\n          if (e.stack) {\n            enhancedError.stack = e.stack;\n          }\n\n          _setInstance(undefined);\n          _setError(enhancedError);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 816, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/hooks/useEthersSigner.tsx"],"sourcesContent":["import { useMemo } from \"react\";\nimport { useWalletClient, usePublicClient } from \"wagmi\";\nimport { BrowserProvider, JsonRpcSigner, JsonRpcProvider } from \"ethers\";\n\nasync function walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\n  const { account, chain, transport } = walletClient;\n  const network = {\n    chainId: chain.id,\n    name: chain.name,\n    ensAddress: chain.contracts?.ensRegistry?.address,\n  };\n\n  // Handle different transport types\n  let provider: BrowserProvider;\n  if (transport && typeof transport === \"object\" && \"request\" in transport) {\n    // EIP1193 provider\n    provider = new BrowserProvider(transport as any, network);\n  } else {\n    // Fallback to window.ethereum\n    if (typeof window !== \"undefined\" && (window as any).ethereum) {\n      provider = new BrowserProvider((window as any).ethereum, network);\n    } else {\n      throw new Error(\"No provider available\");\n    }\n  }\n  \n  const signer = await provider.getSigner(account.address);\n  return signer;\n}\n\nfunction publicClientToProvider(publicClient: any): JsonRpcProvider | undefined {\n  if (!publicClient) return undefined;\n  \n  const { chain, transport } = publicClient;\n  if (!chain) return undefined;\n\n  const network = {\n    chainId: chain.id,\n    name: chain.name,\n    ensAddress: chain.contracts?.ensRegistry?.address,\n  };\n\n  // Handle http transport\n  if (transport && typeof transport === \"object\") {\n    if (\"url\" in transport && typeof transport.url === \"string\") {\n      return new JsonRpcProvider(transport.url, network, { staticNetwork: true });\n    }\n    // Try to get URL from transport config\n    if (\"value\" in transport && transport.value && \"url\" in transport.value) {\n      return new JsonRpcProvider(transport.value.url, network, { staticNetwork: true });\n    }\n  }\n  \n  // Fallback: use chain RPC URL\n  if (chain.rpcUrls && chain.rpcUrls.default && chain.rpcUrls.default.http && chain.rpcUrls.default.http[0]) {\n    return new JsonRpcProvider(chain.rpcUrls.default.http[0], network, { staticNetwork: true });\n  }\n  \n  return undefined;\n}\n\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\n  const { data: walletClient } = useWalletClient({ chainId });\n  // Note: This returns a Promise, handle it in the component\n  return walletClient ? walletClientToSigner(walletClient) : undefined;\n}\n\nexport function useEthersProvider({ chainId }: { chainId?: number } = {}) {\n  const publicClient = usePublicClient({ chainId });\n  return useMemo(\n    () => publicClientToProvider(publicClient),\n    [publicClient]\n  );\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,eAAe,qBAAqB,YAAiB;QAKrC,8BAAA;IAJd,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IAEA,mCAAmC;IACnC,IAAI;IACJ,IAAI,aAAa,OAAO,cAAc,YAAY,aAAa,WAAW;QACxE,mBAAmB;QACnB,WAAW,IAAI,0MAAe,CAAC,WAAkB;IACnD,OAAO;QACL,8BAA8B;QAC9B,IAAI,aAAkB,eAAe,AAAC,OAAe,QAAQ,EAAE;YAC7D,WAAW,IAAI,0MAAe,CAAC,AAAC,OAAe,QAAQ,EAAE;QAC3D,OAAO;YACL,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,SAAS,MAAM,SAAS,SAAS,CAAC,QAAQ,OAAO;IACvD,OAAO;AACT;AAEA,SAAS,uBAAuB,YAAiB;QASjC,8BAAA;IARd,IAAI,CAAC,cAAc,OAAO;IAE1B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IAC7B,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IAEA,wBAAwB;IACxB,IAAI,aAAa,OAAO,cAAc,UAAU;QAC9C,IAAI,SAAS,aAAa,OAAO,UAAU,GAAG,KAAK,UAAU;YAC3D,OAAO,IAAI,0MAAe,CAAC,UAAU,GAAG,EAAE,SAAS;gBAAE,eAAe;YAAK;QAC3E;QACA,uCAAuC;QACvC,IAAI,WAAW,aAAa,UAAU,KAAK,IAAI,SAAS,UAAU,KAAK,EAAE;YACvE,OAAO,IAAI,0MAAe,CAAC,UAAU,KAAK,CAAC,GAAG,EAAE,SAAS;gBAAE,eAAe;YAAK;QACjF;IACF;IAEA,8BAA8B;IAC9B,IAAI,MAAM,OAAO,IAAI,MAAM,OAAO,CAAC,OAAO,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE;QACzG,OAAO,IAAI,0MAAe,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,SAAS;YAAE,eAAe;QAAK;IAC3F;IAEA,OAAO;AACT;AAEO,SAAS;QAAgB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACnE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe,EAAC;QAAE;IAAQ;IACzD,2DAA2D;IAC3D,OAAO,eAAe,qBAAqB,gBAAgB;AAC7D;GAJgB;;QACiB,kMAAe;;;AAKzC,SAAS;QAAkB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACrE,MAAM,eAAe,IAAA,kMAAe,EAAC;QAAE;IAAQ;IAC/C,OAAO,IAAA,oLAAO;qCACZ,IAAM,uBAAuB;oCAC7B;QAAC;KAAa;AAElB;IANgB;;QACO,kMAAe","debugId":null}},
    {"offset": {"line": 925, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\nimport {\n  EIP712Type,\n  FhevmDecryptionSignatureType,\n  FhevmInstance,\n} from \"./fhevmTypes\";\nimport { GenericStringStorage } from \"./GenericStringStorage\";\n\nfunction _timestampNow(): number {\n  return Math.floor(Date.now() / 1000);\n}\n\nclass FhevmDecryptionSignatureStorageKey {\n  #contractAddresses: `0x${string}`[];\n  #userAddress: `0x${string}`;\n  #publicKey: string | undefined;\n  #key: string;\n\n  constructor(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ) {\n    if (!ethers.isAddress(userAddress)) {\n      throw new TypeError(`Invalid address ${userAddress}`);\n    }\n\n    const sortedContractAddresses = (\n      contractAddresses as `0x${string}`[]\n    ).sort();\n\n    const emptyEIP712 = instance.createEIP712(\n      publicKey ?? ethers.ZeroAddress,\n      sortedContractAddresses,\n      0,\n      0\n    );\n\n    try {\n      const hash = ethers.TypedDataEncoder.hash(\n        emptyEIP712.domain,\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\n        emptyEIP712.message\n      );\n\n      this.#contractAddresses = sortedContractAddresses;\n      this.#userAddress = userAddress as `0x${string}`;\n\n      this.#key = `${userAddress}:${hash}`;\n    } catch (e) {\n      console.log(e);\n      throw e;\n    }\n  }\n\n  get contractAddresses(): `0x${string}`[] {\n    return this.#contractAddresses;\n  }\n\n  get userAddress(): `0x${string}` {\n    return this.#userAddress;\n  }\n\n  get publicKey(): string | undefined {\n    return this.#publicKey;\n  }\n\n  get key(): string {\n    return this.#key;\n  }\n}\n\nexport class FhevmDecryptionSignature {\n  #publicKey: string;\n  #privateKey: string;\n  #signature: string;\n  #startTimestamp: number;\n  #durationDays: number;\n  #userAddress: `0x${string}`;\n  #contractAddresses: `0x${string}`[];\n  #eip712: EIP712Type;\n\n  private constructor(parameters: FhevmDecryptionSignatureType) {\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\n    }\n    this.#publicKey = parameters.publicKey;\n    this.#privateKey = parameters.privateKey;\n    this.#signature = parameters.signature;\n    this.#startTimestamp = parameters.startTimestamp;\n    this.#durationDays = parameters.durationDays;\n    this.#userAddress = parameters.userAddress;\n    this.#contractAddresses = parameters.contractAddresses;\n    this.#eip712 = parameters.eip712;\n  }\n\n  public get privateKey() {\n    return this.#privateKey;\n  }\n\n  public get publicKey() {\n    return this.#publicKey;\n  }\n\n  public get signature() {\n    return this.#signature;\n  }\n\n  public get contractAddresses() {\n    return this.#contractAddresses;\n  }\n\n  public get startTimestamp() {\n    return this.#startTimestamp;\n  }\n\n  public get durationDays() {\n    return this.#durationDays;\n  }\n\n  public get userAddress() {\n    return this.#userAddress;\n  }\n\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\n    if (!s || typeof s !== \"object\") {\n      return false;\n    }\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\n      return false;\n    }\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\n      return false;\n    }\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\n      return false;\n    }\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\n      return false;\n    }\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\n      return false;\n    }\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\n      return false;\n    }\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\n    }\n    if (\n      !(\n        \"userAddress\" in s &&\n        typeof s.userAddress === \"string\" &&\n        s.userAddress.startsWith(\"0x\")\n      )\n    ) {\n      return false;\n    }\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\n      return false;\n    }\n\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\n      return false;\n    }\n    if (\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\n    ) {\n      return false;\n    }\n    if (!(\"message\" in s.eip712)) {\n      return false;\n    }\n    if (\n      !(\n        \"types\" in s.eip712 &&\n        typeof s.eip712.types === \"object\" &&\n        s.eip712.types !== null\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  toJSON() {\n    return {\n      publicKey: this.#publicKey,\n      privateKey: this.#privateKey,\n      signature: this.#signature,\n      startTimestamp: this.#startTimestamp,\n      durationDays: this.#durationDays,\n      userAddress: this.#userAddress,\n      contractAddresses: this.#contractAddresses,\n      eip712: this.#eip712,\n    };\n  }\n\n  static fromJSON(json: unknown) {\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\n    return new FhevmDecryptionSignature(data);\n  }\n\n  equals(s: FhevmDecryptionSignatureType) {\n    return s.signature === this.#signature;\n  }\n\n  isValid(): boolean {\n    return (\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\n    );\n  }\n\n  async saveToGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    withPublicKey: boolean\n  ) {\n    try {\n      const value = JSON.stringify(this);\n\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        this.#contractAddresses,\n        this.#userAddress,\n        withPublicKey ? this.#publicKey : undefined\n      );\n      await storage.setItem(storageKey.key, value);\n      console.log(\n        `signature saved! contracts=${this.#contractAddresses.length}`\n      );\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\n      );\n    }\n  }\n\n  static async loadFromGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        contractAddresses,\n        userAddress,\n        publicKey\n      );\n\n      const result = await storage.getItem(storageKey.key);\n\n      if (!result) {\n        console.warn(`Could not load signature! key=${storageKey.key}`);\n        return null;\n      }\n\n      try {\n        const kps = FhevmDecryptionSignature.fromJSON(result);\n        if (!kps.isValid()) {\n          return null;\n        }\n\n        return kps;\n      } catch {\n        return null;\n      }\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\n      );\n      return null;\n    }\n  }\n\n  static async new(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    publicKey: string,\n    privateKey: string,\n    signer: ethers.Signer\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\n      const startTimestamp = _timestampNow();\n      const durationDays = 365;\n      const eip712 = instance.createEIP712(\n        publicKey,\n        contractAddresses,\n        startTimestamp,\n        durationDays\n      );\n      const signature = await signer.signTypedData(\n        eip712.domain,\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n        eip712.message\n      );\n      return new FhevmDecryptionSignature({\n        publicKey,\n        privateKey,\n        contractAddresses: contractAddresses as `0x${string}`[],\n        startTimestamp,\n        durationDays,\n        signature,\n        eip712: eip712 as EIP712Type,\n        userAddress,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  static async loadOrSign(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    signer: ethers.Signer,\n    storage: GenericStringStorage,\n    keyPair?: { publicKey: string; privateKey: string }\n  ): Promise<FhevmDecryptionSignature | null> {\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\n\n    const cached: FhevmDecryptionSignature | null =\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\n        storage,\n        instance,\n        contractAddresses,\n        userAddress,\n        keyPair?.publicKey\n      );\n\n    if (cached) {\n      return cached;\n    }\n\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\n\n    const sig = await FhevmDecryptionSignature.new(\n      instance,\n      contractAddresses,\n      publicKey,\n      privateKey,\n      signer\n    );\n\n    if (!sig) {\n      return null;\n    }\n\n    await sig.saveToGenericStringStorage(\n      storage,\n      instance,\n      Boolean(keyPair?.publicKey)\n    );\n\n    return sig;\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1202, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/abi/DreamJournalAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const DreamJournalAddresses = { \n  \"11155111\": { address: \"0x0000000000000000000000000000000000000000\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0xC5273AbFb36550090095B1EDec019216AD21BE6c\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,wBAAwB;IACnC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 1228, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/abi/DreamJournalABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const DreamJournalABI = {\n  \"abi\": [\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"accessor\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"DreamAccessed\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"uint256\",\n          \"name\": \"length\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"DreamContentLength\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"owner\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"uint64\",\n          \"name\": \"createdAt\",\n          \"type\": \"uint64\"\n        }\n      ],\n      \"name\": \"DreamCreated\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"decryptor\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"uint64\",\n          \"name\": \"timestamp\",\n          \"type\": \"uint64\"\n        }\n      ],\n      \"name\": \"DreamDecrypted\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"externalEuint8[]\",\n          \"name\": \"encContent\",\n          \"type\": \"bytes32[]\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"createDream\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"dreamExists\",\n      \"outputs\": [\n        {\n          \"internalType\": \"bool\",\n          \"name\": \"exists\",\n          \"type\": \"bool\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamContentByte\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint8\",\n          \"name\": \"encByte\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamContentLength\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"length\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getDreamCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"count\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getDreamIds\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256[]\",\n          \"name\": \"ids\",\n          \"type\": \"uint256[]\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamMeta\",\n      \"outputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"owner\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"uint64\",\n          \"name\": \"createdAt\",\n          \"type\": \"uint64\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getTotalDreamCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"count\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"recordContentAccess\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"recordDecryption\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1550, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/hooks/useDreamJournal.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport {\n  RefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\nimport { DreamJournalAddresses } from \"@/abi/DreamJournalAddresses\";\nimport { DreamJournalABI } from \"@/abi/DreamJournalABI\";\n\ntype DreamInfoType = {\n  abi: typeof DreamJournalABI.abi;\n  address?: `0x${string}`;\n  chainId?: number;\n  chainName?: string;\n};\n\nexport type Dream = {\n  id: bigint;\n  title: string;\n  owner: string;\n  createdAt: bigint;\n  decryptedContent?: string;\n  isDecrypting?: boolean;\n};\n\n/**\n * Resolves DreamJournal contract metadata for the given EVM `chainId`.\n */\nfunction getDreamJournalByChainId(\n  chainId: number | undefined\n): DreamInfoType {\n  if (!chainId) {\n    return { abi: DreamJournalABI.abi };\n  }\n\n  const entry =\n    DreamJournalAddresses[chainId.toString() as keyof typeof DreamJournalAddresses];\n\n  if (!(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\n    return { abi: DreamJournalABI.abi, chainId };\n  }\n\n  return {\n    address: entry?.address as `0x${string}` | undefined,\n    chainId: entry?.chainId ?? chainId,\n    chainName: entry?.chainName,\n    abi: DreamJournalABI.abi,\n  };\n}\n\nexport const useDreamJournal = (parameters: {\n  instance: FhevmInstance | undefined;\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\n  eip1193Provider: ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  ethersSigner: ethers.JsonRpcSigner | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\n  sameSigner: RefObject<\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean | Promise<boolean>\n  >;\n}) => {\n  const {\n    instance,\n    fhevmDecryptionSignatureStorage,\n    chainId,\n    ethersSigner,\n    ethersReadonlyProvider,\n    sameChain,\n    sameSigner,\n  } = parameters;\n\n  // States\n  const [dreams, setDreams] = useState<Dream[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [isCreating, setIsCreating] = useState<boolean>(false);\n  const [message, setMessage] = useState<string>(\"\");\n  \n  const dreamJournalRef = useRef<DreamInfoType | undefined>(undefined);\n  const isLoadingRef = useRef<boolean>(false);\n  const isCreatingRef = useRef<boolean>(false);\n\n  // Contract info\n  const dreamJournal = useMemo(() => {\n    const c = getDreamJournalByChainId(chainId);\n    dreamJournalRef.current = c;\n    if (!c.address) {\n      setMessage(`DreamJournal deployment not found for chainId=${chainId}.`);\n    }\n    return c;\n  }, [chainId]);\n\n  const isDeployed = useMemo(() => {\n    if (!dreamJournal) {\n      return undefined;\n    }\n    return Boolean(dreamJournal.address) && dreamJournal.address !== ethers.ZeroAddress;\n  }, [dreamJournal]);\n\n  const canCreate = useMemo(() => {\n    // Allow creating even if instance is not ready - it will be checked in createDream\n    return Boolean(dreamJournal.address && ethersSigner && !isCreating && !isLoading);\n  }, [dreamJournal.address, ethersSigner, isCreating, isLoading]);\n\n  const canLoadDreams = useMemo(() => {\n    return dreamJournal.address && ethersReadonlyProvider && ethersSigner && !isLoading;\n  }, [dreamJournal.address, ethersReadonlyProvider, ethersSigner, isLoading]);\n\n  // Load user's dreams\n  const loadDreams = useCallback(() => {\n    if (isLoadingRef.current) {\n      return;\n    }\n\n    if (\n      !dreamJournalRef.current ||\n      !dreamJournalRef.current?.chainId ||\n      !dreamJournalRef.current?.address ||\n      !ethersReadonlyProvider ||\n      !ethersSigner\n    ) {\n      setDreams([]);\n      return;\n    }\n\n    isLoadingRef.current = true;\n    setIsLoading(true);\n    setMessage(\"Loading dreams...\");\n\n    const thisChainId = dreamJournalRef.current.chainId;\n    const thisContractAddress = dreamJournalRef.current.address;\n    const thisEthersReadonlyProvider = ethersReadonlyProvider;\n    const thisEthersSigner = ethersSigner;\n\n    const contract = new ethers.Contract(\n      thisContractAddress,\n      dreamJournalRef.current.abi,\n      thisEthersReadonlyProvider\n    );\n\n    const run = async () => {\n      try {\n        const userAddress = await thisEthersSigner.getAddress();\n        const dreamIds = await contract.getDreamIds(userAddress);\n        \n        if (\n          !sameChain.current(thisChainId) ||\n          thisContractAddress !== dreamJournalRef.current?.address\n        ) {\n          return;\n        }\n\n        const dreamList: Dream[] = [];\n        \n        for (let i = 0; i < dreamIds.length; i++) {\n          const id = dreamIds[i];\n          const [owner, title, createdAt] = await contract.getDreamMeta(id);\n          \n          dreamList.push({\n            id: BigInt(id),\n            title,\n            owner,\n            createdAt: BigInt(createdAt),\n          });\n        }\n\n        if (\n          sameChain.current(thisChainId) &&\n          thisContractAddress === dreamJournalRef.current?.address\n        ) {\n          setDreams(dreamList);\n          setMessage(`Loaded ${dreamList.length} dream(s)`);\n        }\n      } catch (e) {\n        setMessage(\"Failed to load dreams: \" + e);\n        if (\n          sameChain.current(thisChainId) &&\n          thisContractAddress === dreamJournalRef.current?.address\n        ) {\n          setDreams([]);\n        }\n      } finally {\n        isLoadingRef.current = false;\n        setIsLoading(false);\n      }\n    };\n\n    run();\n  }, [ethersReadonlyProvider, ethersSigner, sameChain]);\n\n  // Auto load dreams - use ref to prevent infinite loop\n  const canLoadDreamsRef = useRef(false);\n  const lastLoadRef = useRef<string>(\"\");\n  const loadTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  \n  useEffect(() => {\n    canLoadDreamsRef.current = canLoadDreams;\n  }, [canLoadDreams]);\n\n  useEffect(() => {\n    // Clear any pending timeout\n    if (loadTimeoutRef.current) {\n      clearTimeout(loadTimeoutRef.current);\n      loadTimeoutRef.current = null;\n    }\n\n    // Create a unique key for this load attempt\n    const address = dreamJournal.address || \"\";\n    const loadKey = `${address}-${chainId}-${!!ethersReadonlyProvider}-${!!ethersSigner}`;\n    \n    // Only load if conditions changed and we haven't loaded for this key\n    if (canLoadDreams && loadKey !== lastLoadRef.current && !isLoadingRef.current) {\n      lastLoadRef.current = loadKey;\n      // Use setTimeout to debounce and prevent rapid calls\n      loadTimeoutRef.current = setTimeout(() => {\n        if (!isLoadingRef.current) {\n          loadDreams();\n        }\n        loadTimeoutRef.current = null;\n      }, 300); // Increased debounce time\n    }\n\n    return () => {\n      if (loadTimeoutRef.current) {\n        clearTimeout(loadTimeoutRef.current);\n        loadTimeoutRef.current = null;\n      }\n    };\n  }, [dreamJournal.address, chainId, ethersReadonlyProvider, ethersSigner, canLoadDreams, loadDreams]);\n\n  // Create new dream\n  const createDream = useCallback(\n    (title: string, content: string) => {\n      if (isCreatingRef.current || isLoadingRef.current) {\n        console.log(\"[createDream] Already creating or loading, ignoring duplicate call\");\n        return;\n      }\n\n      if (!dreamJournal.address || !ethersSigner || !title || !content) {\n        setMessage(\"Please fill in both title and content\");\n        return;\n      }\n\n      // Check instance only when actually creating\n      if (!instance) {\n        const errorMsg = \"FHEVM instance is not ready. Please wait for initialization...\";\n        setMessage(errorMsg);\n        console.error(\"[createDream] FHEVM instance not available:\", {\n          hasInstance: !!instance,\n          chainId,\n          contractAddress: dreamJournal.address,\n          hasSigner: !!ethersSigner,\n        });\n        isCreatingRef.current = false;\n        setIsCreating(false);\n        return;\n      }\n\n      const thisChainId = chainId;\n      const thisContractAddress = dreamJournal.address;\n      const thisEthersSigner = ethersSigner;\n      const thisContract = new ethers.Contract(\n        thisContractAddress,\n        dreamJournal.abi,\n        thisEthersSigner\n      );\n\n      isCreatingRef.current = true;\n      setIsCreating(true);\n      setMessage(\"Encrypting dream content...\");\n\n      const run = async () => {\n        // Let browser repaint before encryption (CPU-intensive)\n        await new Promise((resolve) => setTimeout(resolve, 100));\n\n        const isStale = () =>\n          thisContractAddress !== dreamJournalRef.current?.address ||\n          !sameChain.current(thisChainId) ||\n          !sameSigner.current(thisEthersSigner);\n\n        try {\n          // Convert string to bytes\n          const contentBytes = ethers.toUtf8Bytes(content);\n\n          // Encrypt each byte\n          const encryptedInput = instance.createEncryptedInput(\n            thisContractAddress,\n            thisEthersSigner.address\n          );\n\n          for (let i = 0; i < contentBytes.length; i++) {\n            encryptedInput.add8(contentBytes[i]);\n          }\n\n          // Encrypt (CPU-intensive)\n          console.log(\"[createDream] Starting encryption...\");\n          console.log(\"[createDream] Encryption context:\", {\n            contractAddress: thisContractAddress,\n            userAddress: thisEthersSigner.address,\n            chainId: thisChainId,\n            isMock: false, // Sepolia uses real relayer\n          });\n          \n          let encrypted;\n          try {\n            encrypted = await encryptedInput.encrypt();\n            console.log(\"[createDream] Encryption completed, handles:\", encrypted.handles.length);\n          } catch (encryptError: any) {\n            const errorMsg = encryptError?.message || String(encryptError);\n            console.error(\"[createDream] Encryption failed:\", {\n              error: errorMsg,\n              name: encryptError?.name,\n              stack: encryptError?.stack,\n            });\n            \n            // Provide user-friendly error message\n            if (errorMsg.includes(\"Relayer\") || errorMsg.includes(\"Bad JSON\")) {\n              throw new Error(\n                `FHEVM Relayer error: ${errorMsg}\\n\\n` +\n                `This may be a temporary issue with the FHEVM Relayer service on Sepolia.\\n` +\n                `Please try again in a few moments, or switch to Hardhat Local network for testing.`\n              );\n            }\n            throw encryptError;\n          }\n          console.log(\"[createDream] Handles type check:\", {\n            isArray: Array.isArray(encrypted.handles),\n            firstHandleType: typeof encrypted.handles[0],\n            firstHandleValue: encrypted.handles[0],\n          });\n\n          // Check if stale after encryption\n          const staleCheck = await isStale();\n          console.log(\"[createDream] Stale check after encryption:\", staleCheck);\n          if (staleCheck) {\n            const signerCheck = sameSigner.current(thisEthersSigner);\n            const signerMatch = typeof signerCheck === 'boolean' ? signerCheck : await signerCheck;\n            console.log(\"[createDream] Stale after encryption, aborting. Details:\", {\n              contractAddressMatch: thisContractAddress === dreamJournalRef.current?.address,\n              chainMatch: sameChain.current(thisChainId),\n              signerMatch: signerMatch,\n              currentAddress: dreamJournalRef.current?.address,\n              thisAddress: thisContractAddress,\n              currentChainId: dreamJournalRef.current?.chainId,\n              thisChainId,\n            });\n            setMessage(\"Ignore dream creation - state changed\");\n            isCreatingRef.current = false;\n            setIsCreating(false);\n            return;\n          }\n          \n          console.log(\"[createDream] Not stale, proceeding with transaction submission...\");\n\n          setMessage(\"Submitting dream to blockchain...\");\n          console.log(\"[createDream] Preparing transaction...\");\n          \n          try {\n            const signerAddress = await thisEthersSigner.getAddress();\n            console.log(\"[createDream] Contract instance:\", {\n              address: thisContractAddress,\n              hasContract: !!thisContract,\n              signerAddress,\n            });\n          } catch (addrError) {\n            console.error(\"[createDream] Error getting signer address:\", addrError);\n            throw new Error(\"Failed to get signer address\");\n          }\n\n          // ABI shows externalEuint8[] is compiled as bytes32[]\n          // So we pass handles directly as bytes32[] array, not as struct array\n          // The handles are already in the correct format (hex strings)\n          const handlesArray = encrypted.handles;\n\n          // Safe logging\n          const firstHandle = handlesArray[0];\n          const firstHandlePreview = typeof firstHandle === 'string' \n            ? firstHandle.substring(0, 20) + \"...\" \n            : String(firstHandle || 'undefined').substring(0, 30);\n\n          console.log(\"[createDream] Prepared handles array:\", {\n            arrayLength: handlesArray.length,\n            firstHandle: firstHandlePreview,\n            firstHandleType: typeof firstHandle,\n            hasInputProof: !!encrypted.inputProof,\n            inputProofLength: encrypted.inputProof?.length || 0,\n          });\n\n          // Call contract\n          console.log(\"[createDream] Calling createDream contract method...\", {\n            title,\n            encryptedBytes: handlesArray.length,\n            hasInputProof: !!encrypted.inputProof,\n            contractAddress: thisContractAddress,\n          });\n\n          const tx: ethers.TransactionResponse = await thisContract.createDream(\n            title,\n            handlesArray,\n            encrypted.inputProof\n          );\n          \n          console.log(\"[createDream] Transaction sent:\", tx.hash);\n          console.log(\"[createDream] Transaction details:\", {\n            hash: tx.hash,\n            to: tx.to,\n            from: tx.from,\n            value: tx.value?.toString(),\n          });\n          setMessage(`Wait for tx:${tx.hash}...`);\n\n          const receipt = await tx.wait();\n\n          setMessage(`Dream created! status=${receipt?.status}`);\n          console.log(\"[createDream] Dream created successfully!\", { txHash: tx.hash, status: receipt?.status });\n\n          if (await isStale()) {\n            setMessage(\"Ignore dream creation\");\n            isCreatingRef.current = false;\n            setIsCreating(false);\n            return;\n          }\n\n          // Reload dreams\n          loadDreams();\n          \n          // Signal success to component\n          setMessage(`Dream created successfully! Transaction: ${tx.hash.slice(0, 10)}...`);\n        } catch (e: any) {\n          const errorMsg = e?.message || \"Failed to create dream\";\n          setMessage(`Create dream failed: ${errorMsg}`);\n          console.error(\"[createDream] Error:\", e);\n          console.error(\"[createDream] Error details:\", {\n            name: e?.name,\n            message: errorMsg,\n            code: e?.code,\n            data: e?.data,\n            reason: e?.reason,\n            stack: e?.stack,\n          });\n          \n          // Show alert for user-friendly error message\n          if (errorMsg.includes(\"user rejected\") || errorMsg.includes(\"User denied\") || errorMsg.includes(\"rejected\") || errorMsg.includes(\"User rejected\")) {\n            alert(\"Transaction was cancelled. Please try again when ready.\");\n          } else if (errorMsg.includes(\"insufficient funds\") || errorMsg.includes(\"insufficient balance\")) {\n            alert(\"Insufficient funds. Please add ETH to your wallet.\");\n          } else if (errorMsg.includes(\"Relayer\") || errorMsg.includes(\"Bad JSON\")) {\n            alert(\n              \"FHEVM Relayer Error\\n\\n\" +\n              \"The FHEVM Relayer service on Sepolia may be temporarily unavailable or experiencing issues.\\n\\n\" +\n              \"Suggestions:\\n\" +\n              \"1. Wait a few moments and try again\\n\" +\n              \"2. Switch to Hardhat Local network for local testing\\n\" +\n              \"3. Check the browser console (F12) for more details\\n\\n\" +\n              `Error: ${errorMsg}`\n            );\n          } else if (errorMsg.includes(\"network\") || errorMsg.includes(\"Network\") || errorMsg.includes(\"ECONNREFUSED\")) {\n            alert(`Network error: ${errorMsg}\\n\\nPlease check:\\n1. Hardhat node is running (npx hardhat node)\\n2. Wallet is connected to Hardhat Local network (Chain ID: 31337)`);\n          } else {\n            alert(`Failed to create dream: ${errorMsg}\\n\\nCheck the browser console (F12) for more details.`);\n          }\n        } finally {\n          isCreatingRef.current = false;\n          setIsCreating(false);\n        }\n      };\n\n      run();\n    },\n    [\n      dreamJournal.address,\n      dreamJournal.abi,\n      instance,\n      chainId,\n      ethersSigner,\n      loadDreams,\n      sameChain,\n      sameSigner,\n    ]\n  );\n\n  // Decrypt dream content\n  const decryptDream = useCallback(\n    (dreamId: bigint) => {\n      if (isLoadingRef.current) {\n        return;\n      }\n\n      if (!dreamJournal.address || !instance || !ethersSigner || !ethersReadonlyProvider) {\n        return;\n      }\n\n      // Check if already decrypted\n      const dream = dreams.find((d) => d.id === dreamId);\n      if (dream?.decryptedContent) {\n        return;\n      }\n\n      const thisChainId = chainId;\n      const thisContractAddress = dreamJournal.address;\n      const thisEthersSigner = ethersSigner;\n      const thisEthersReadonlyProvider = ethersReadonlyProvider;\n\n      isLoadingRef.current = true;\n      setIsLoading(true);\n      \n      // Update dream state to show decrypting\n      setDreams((prev) =>\n        prev.map((d) => (d.id === dreamId ? { ...d, isDecrypting: true } : d))\n      );\n      setMessage(`Decrypting dream #${dreamId}...`);\n\n      const run = async () => {\n        const isStale = async () => {\n          const addressMatch = thisContractAddress === dreamJournalRef.current?.address;\n          const chainMatch = sameChain.current(thisChainId);\n          const signerCheck = sameSigner.current(thisEthersSigner);\n          const signerMatch = typeof signerCheck === 'boolean' ? signerCheck : await signerCheck;\n          return !addressMatch || !chainMatch || !signerMatch;\n        };\n\n        try {\n          const contract = new ethers.Contract(\n            thisContractAddress,\n            dreamJournalRef.current!.abi,\n            thisEthersReadonlyProvider\n          );\n\n          // Get content length\n          const length = await contract.getDreamContentLength(dreamId);\n          \n          if (await isStale()) {\n            return;\n          }\n\n          // Get decryption signature\n          const sig: FhevmDecryptionSignature | null =\n            await FhevmDecryptionSignature.loadOrSign(\n              instance,\n              [thisContractAddress as `0x${string}`],\n              thisEthersSigner,\n              fhevmDecryptionSignatureStorage\n            );\n\n          if (!sig) {\n            setMessage(\"Unable to build FHEVM decryption signature\");\n            return;\n          }\n\n          if (await isStale()) {\n            setMessage(\"Ignore decryption\");\n            return;\n          }\n\n          setMessage(\"Decrypting content...\");\n\n          // Decrypt each byte\n          const decryptedBytes: number[] = [];\n          \n          // Get all encrypted bytes first\n          const encryptedBytes: string[] = [];\n          for (let i = 0; i < Number(length); i++) {\n            if (await isStale()) {\n              return;\n            }\n            const encByte = await contract.getDreamContentByte(dreamId, i);\n            // Convert to bytes32 format (handle)\n            const handle = typeof encByte === \"string\" ? encByte : ethers.hexlify(encByte);\n            encryptedBytes.push(handle);\n          }\n\n          if (await isStale()) {\n            setMessage(\"Ignore decryption\");\n            return;\n          }\n\n          // Prepare handle-contract pairs for batch decryption\n          const handleContractPairs = encryptedBytes.map((handle) => ({\n            handle,\n            contractAddress: thisContractAddress,\n          }));\n\n          setMessage(\"Decrypting content...\");\n\n          // Decrypt all bytes at once (more efficient)\n          const decryptedResult = await instance.userDecrypt(\n            handleContractPairs,\n            sig.privateKey,\n            sig.publicKey,\n            sig.signature,\n            sig.contractAddresses,\n            sig.userAddress,\n            sig.startTimestamp,\n            sig.durationDays\n          );\n\n          if (await isStale()) {\n            setMessage(\"Ignore decryption\");\n            return;\n          }\n\n          // Extract decrypted values\n          for (let i = 0; i < encryptedBytes.length; i++) {\n            const handle = encryptedBytes[i];\n            const decryptedValue = decryptedResult[handle];\n            if (decryptedValue !== undefined) {\n              decryptedBytes.push(Number(decryptedValue));\n            } else {\n              // Fallback: decrypt individually if batch fails\n              console.warn(`Failed to decrypt byte ${i}, trying individually...`);\n              const individualResult = await instance.userDecrypt(\n                [{ handle, contractAddress: thisContractAddress }],\n                sig.privateKey,\n                sig.publicKey,\n                sig.signature,\n                sig.contractAddresses,\n                sig.userAddress,\n                sig.startTimestamp,\n                sig.durationDays\n              );\n              decryptedBytes.push(Number(individualResult[handle] || 0));\n            }\n          }\n\n          if (await isStale()) {\n            setMessage(\"Ignore decryption\");\n            return;\n          }\n\n          // Convert bytes to string\n          const decryptedContent = ethers.toUtf8String(new Uint8Array(decryptedBytes));\n\n          // Update dream with decrypted content\n          setDreams((prev) =>\n            prev.map((d) =>\n              d.id === dreamId\n                ? { ...d, decryptedContent, isDecrypting: false }\n                : { ...d, isDecrypting: false }\n            )\n          );\n\n          setMessage(\"Decryption completed!\");\n        } catch (e: any) {\n          const errorMsg = e?.message || \"Failed to decrypt dream\";\n          setMessage(`Decryption failed: ${errorMsg}`);\n          setDreams((prev) =>\n            prev.map((d) => (d.id === dreamId ? { ...d, isDecrypting: false } : d))\n          );\n        } finally {\n          isLoadingRef.current = false;\n          setIsLoading(false);\n        }\n      };\n\n      run();\n    },\n    [\n      dreamJournal.address,\n      dreams,\n      instance,\n      chainId,\n      ethersSigner,\n      ethersReadonlyProvider,\n      fhevmDecryptionSignatureStorage,\n      sameChain,\n      sameSigner,\n    ]\n  );\n\n  const refreshDreams = useCallback(() => {\n    return loadDreams();\n  }, [loadDreams]);\n\n  return {\n    contractAddress: dreamJournal.address,\n    dreams,\n    isLoading,\n    isCreating,\n    message,\n    canCreate,\n    canLoadDreams,\n    isDeployed,\n    createDream,\n    loadDreams,\n    refreshDreams,\n    decryptDream,\n  };\n};\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2156, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/components/ErrorNotDeployed.tsx"],"sourcesContent":["export function errorNotDeployed(chainId: number | undefined) {\n  return (\n    <div className=\"grid w-full gap-4 mx-auto font-semibold bg-none\">\n      <div className=\"col-span-full mx-20\">\n        <p className=\"text-4xl leading-relaxed\">\n          {\" \"}\n          <span className=\"font-mono bg-red-500\">Error</span>:{\" \"}\n          <span className=\"font-mono bg-white\">DreamJournal.sol</span> Contract\n          Not Deployed on{\" \"}\n          <span className=\"font-mono bg-white\">chainId={chainId}</span>{\" \"}\n          {chainId === 11155111 ? \"(Sepolia)\" : \"\"} or Deployment Address\n          Missing.\n        </p>\n        <p className=\"text-xl leading-relaxed mt-8\">\n          It appears that the{\" \"}\n          <span className=\"font-mono bg-white\">DreamJournal.sol</span> contract\n          has either not been deployed yet, or the deployment address is missing\n          from the ABI directory{\" \"}\n          <span className=\"font-mono bg-white\">frontend/abi</span>. To\n          deploy <span className=\"font-mono bg-white\">DreamJournal.sol</span> on\n          Sepolia, run the following command:\n        </p>\n        <p className=\"font-mono text-2xl leading-relaxed bg-black text-white p-4 mt-12\">\n          <span className=\"opacity-50 italic text-red-500\">\n            #from pro16 directory\n          </span>\n          <br />\n          npx hardhat deploy --network{\" \"}\n          {chainId === 11155111 ? \"sepolia\" : \"your-network-name\"}\n        </p>\n        <p className=\"text-xl leading-relaxed mt-12\">\n          <strong>Recommended:</strong> Switch to the local{\" \"}\n          <span className=\"font-mono bg-white\">Hardhat Node</span> using the\n          Rainbow wallet browser extension.\n        </p>\n        <div className=\"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <p className=\"font-semibold text-blue-800 mb-2\">To use local Hardhat network:</p>\n          <ol className=\"list-decimal list-inside space-y-2 text-blue-700\">\n            <li>Make sure Hardhat node is running: <code className=\"bg-blue-100 px-2 py-1 rounded\">npx hardhat node</code></li>\n            <li>In Rainbow wallet, add custom network:\n              <ul className=\"list-disc list-inside ml-4 mt-1\">\n                <li>Network Name: <code className=\"bg-blue-100 px-1 rounded\">Hardhat Local</code></li>\n                <li>RPC URL: <code className=\"bg-blue-100 px-1 rounded\">http://localhost:8545</code></li>\n                <li>Chain ID: <code className=\"bg-blue-100 px-1 rounded\">31337</code></li>\n                <li>Currency Symbol: <code className=\"bg-blue-100 px-1 rounded\">ETH</code></li>\n              </ul>\n            </li>\n            <li>Switch to Hardhat Local network in Rainbow wallet</li>\n            <li>Refresh this page</li>\n          </ol>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,OAA2B;IAC1D,qBACE,yMAAC;QAAI,WAAU;kBACb,cAAA,yMAAC;YAAI,WAAU;;8BACb,yMAAC;oBAAE,WAAU;;wBACV;sCACD,yMAAC;4BAAK,WAAU;sCAAuB;;;;;;wBAAY;wBAAE;sCACrD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;wBAC5C;sCAChB,yMAAC;4BAAK,WAAU;;gCAAqB;gCAAS;;;;;;;wBAAgB;wBAC7D,YAAY,WAAW,cAAc;wBAAG;;;;;;;8BAG3C,yMAAC;oBAAE,WAAU;;wBAA+B;wBACtB;sCACpB,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;wBAErC;sCACvB,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;sCACjD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;;;;;;;8BAGrE,yMAAC;oBAAE,WAAU;;sCACX,yMAAC;4BAAK,WAAU;sCAAiC;;;;;;sCAGjD,yMAAC;;;;;wBAAK;wBACuB;wBAC5B,YAAY,WAAW,YAAY;;;;;;;8BAEtC,yMAAC;oBAAE,WAAU;;sCACX,yMAAC;sCAAO;;;;;;wBAAqB;wBAAqB;sCAClD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;;;;;;;8BAG1D,yMAAC;oBAAI,WAAU;;sCACb,yMAAC;4BAAE,WAAU;sCAAmC;;;;;;sCAChD,yMAAC;4BAAG,WAAU;;8CACZ,yMAAC;;wCAAG;sDAAmC,yMAAC;4CAAK,WAAU;sDAAgC;;;;;;;;;;;;8CACvF,yMAAC;;wCAAG;sDACF,yMAAC;4CAAG,WAAU;;8DACZ,yMAAC;;wDAAG;sEAAc,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DAC7D,yMAAC;;wDAAG;sEAAS,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DACxD,yMAAC;;wDAAG;sEAAU,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DACzD,yMAAC;;wDAAG;sEAAiB,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;;;;;;;;;;;;;8CAGpE,yMAAC;8CAAG;;;;;;8CACJ,yMAAC;8CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMhB","debugId":null}},
    {"offset": {"line": 2465, "column": 0}, "map": {"version":3,"sources":["file:///E:/Spring/Zama/wanganwen/dream-vault-main/dream-vault-main/frontend/components/DreamJournalDemo.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect, useMemo } from \"react\";\n\n// Input sanitization utility\nconst sanitizeInput = (input: string): string => {\n  return input\n    .replace(/[<>]/g, '') // Remove potential HTML tags\n    .replace(/javascript:/gi, '') // Remove javascript: protocol\n    .replace(/on\\w+=/gi, '') // Remove event handlers\n    .trim();\n};\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\nimport { useAccount, useChainId, useWalletClient } from \"wagmi\";\nimport { ethers } from \"ethers\";\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\nimport { useEthersSigner, useEthersProvider } from \"@/hooks/useEthersSigner\";\nimport { useDreamJournal } from \"@/hooks/useDreamJournal\";\nimport { errorNotDeployed } from \"./ErrorNotDeployed\";\n\nexport const DreamJournalDemo = () => {\n  const { isConnected, address } = useAccount();\n  const chainId = useChainId();\n  const { data: walletClient } = useWalletClient();\n  \n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [showDecrypted, setShowDecrypted] = useState<Record<string, boolean>>({});\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [ethersSigner, setEthersSigner] = useState<ethers.JsonRpcSigner | undefined>(undefined);\n  const [error, setError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\n  \n  const ethersProvider = useEthersProvider({ chainId });\n\n  // Memoize network check to avoid recalculation\n  const isCorrectNetwork = useMemo(() =>\n    chainId === 31337 || chainId === 11155111,\n    [chainId]\n  );\n  \n  // Get EIP1193 provider - for local Hardhat, use RPC URL string directly\n  // For other networks, use walletClient transport or window.ethereum\n  const eip1193Provider = useMemo(() => {\n    if (chainId === 31337) {\n      // For local Hardhat, use RPC URL string\n      return \"http://localhost:8545\";\n    }\n    \n    // For other networks, try to get from walletClient\n    if (walletClient?.transport) {\n      const transport = walletClient.transport as any;\n      // Try to extract EIP1193 provider from transport\n      if (transport.value && typeof transport.value.request === \"function\") {\n        return transport.value;\n      }\n      if (typeof transport.request === \"function\") {\n        return transport;\n      }\n    }\n    \n    // Fallback to window.ethereum\n    if (typeof window !== \"undefined\" && (window as any).ethereum) {\n      return (window as any).ethereum;\n    }\n    \n    return undefined;\n  }, [chainId, walletClient]);\n\n  // Convert walletClient to ethers signer\n  useEffect(() => {\n    if (walletClient) {\n      const { account, chain, transport } = walletClient;\n      const network = {\n        chainId: chain.id,\n        name: chain.name,\n        ensAddress: chain.contracts?.ensRegistry?.address,\n      };\n\n      try {\n        // Create provider from transport\n        const provider = new ethers.BrowserProvider(transport as any, network);\n        provider.getSigner(account.address)\n          .then(setEthersSigner)\n          .catch((err) => {\n            console.error(\"Failed to get signer:\", err);\n            setEthersSigner(undefined);\n          });\n      } catch (err) {\n        console.error(\"Failed to create provider:\", err);\n        setEthersSigner(undefined);\n      }\n    } else {\n      setEthersSigner(undefined);\n    }\n  }, [walletClient]);\n\n  // FHEVM instance\n  const {\n    instance: fhevmInstance,\n    status: fhevmStatus,\n    error: fhevmError,\n  } = useFhevm({\n    provider: eip1193Provider,\n    chainId,\n    initialMockChains: { 31337: \"http://localhost:8545\" },\n    enabled: isConnected && !!eip1193Provider,\n  });\n\n  // Clean up debug logging for production\n\n  // Same chain/signer refs\n  const sameChainRef = useRef((id: number | undefined) => id === chainId);\n  const currentSignerAddressRef = useRef<string | undefined>(undefined);\n  \n  // Update signer address ref when signer changes\n  useEffect(() => {\n    if (ethersSigner) {\n      ethersSigner.getAddress().then((addr) => {\n        currentSignerAddressRef.current = addr.toLowerCase();\n      }).catch(() => {\n        currentSignerAddressRef.current = undefined;\n      });\n    } else {\n      currentSignerAddressRef.current = undefined;\n    }\n  }, [ethersSigner]);\n  \n  const sameSignerRef = useRef(async (signer: ethers.JsonRpcSigner | undefined) => {\n    if (!signer) {\n      return !currentSignerAddressRef.current; // Both undefined\n    }\n    if (!currentSignerAddressRef.current) {\n      return false; // Current signer is undefined but provided signer is not\n    }\n    try {\n      const signerAddress = (await signer.getAddress()).toLowerCase();\n      return signerAddress === currentSignerAddressRef.current;\n    } catch {\n      return false;\n    }\n  });\n\n  // Dream journal hook\n  const {\n    contractAddress,\n    dreams,\n    isLoading,\n    isCreating,\n    message,\n    canCreate,\n    canLoadDreams,\n    isDeployed,\n    createDream,\n    loadDreams,\n    decryptDream,\n  } = useDreamJournal({\n    instance: fhevmInstance,\n    fhevmDecryptionSignatureStorage,\n    eip1193Provider,\n    chainId,\n    ethersSigner: ethersSigner || undefined,\n    ethersReadonlyProvider: ethersProvider || undefined,\n    sameChain: sameChainRef,\n    sameSigner: sameSignerRef,\n  });\n\n  // Memoize validation checks\n  const isValidInput = useMemo(() =>\n    title.trim().length > 0 &&\n    title.trim().length <= 200 &&\n    content.trim().length > 0 &&\n    content.trim().length <= 10000,\n    [title, content]\n  );\n\n  const handleCreateDreamRef = useRef(false);\n  \n  const handleCreateDream = useCallback(() => {\n    // Prevent duplicate calls - use ref to track\n    if (handleCreateDreamRef.current) {\n      console.log(\"[handleCreateDream] Already processing (ref=true), ignoring duplicate call\");\n      return;\n    }\n\n    if (isCreating) {\n      console.log(\"[handleCreateDream] isCreating=true, ignoring duplicate call\");\n      return;\n    }\n\n    // Input validation\n    if (!title.trim()) {\n      alert(\"Please enter a title for your dream\");\n      return;\n    }\n\n    if (!content.trim()) {\n      alert(\"Please enter the content of your dream\");\n      return;\n    }\n\n    if (title.trim().length > 200) {\n      alert(\"Title must be 200 characters or less\");\n      return;\n    }\n\n    if (content.trim().length > 10000) {\n      alert(\"Dream content must be 10,000 characters or less\");\n      return;\n    }\n    \n    // Check if FHEVM instance is ready before creating\n    if (!fhevmInstance) {\n      alert(\"Zama FHEVM instance is not ready. Please wait a moment and try again.\\n\\nIf this persists, check:\\n1. Wallet is connected\\n2. Network is Hardhat Local (Chain ID: 31337) or Sepolia (Chain ID: 11155111)\\n3. Hardhat node is running (for local development)\\n4. FHEVM libraries are properly loaded\");\n      return;\n    }\n    \n    handleCreateDreamRef.current = true;\n    console.log(\"[handleCreateDream] Creating dream with:\", {\n      title: title.trim(),\n      contentLength: content.trim().length,\n      hasInstance: !!fhevmInstance,\n      fhevmStatus,\n      hasSigner: !!ethersSigner,\n      contractAddress,\n      canCreate,\n      isCreating,\n    });\n\n    try {\n      setError(null);\n      // Call createDream\n      createDream(title.trim(), content.trim());\n    } catch (err) {\n      console.error(\"[handleCreateDream] Error creating dream:\", err);\n      setError(err instanceof Error ? err.message : \"Failed to create dream\");\n    }\n    \n    // Reset the ref after a delay to allow retry if needed\n    setTimeout(() => {\n      handleCreateDreamRef.current = false;\n    }, 5000);\n  }, [title, content, createDream, fhevmInstance, fhevmStatus, ethersSigner, contractAddress, canCreate, isCreating]);\n  \n  // Clear form when dream is created successfully and show success message\n  useEffect(() => {\n    if (message && message.includes(\"Dream created successfully\")) {\n      setTitle(\"\");\n      setContent(\"\");\n      setSuccessMessage(message);\n      setError(null);\n      // Auto-clear success message after 5 seconds\n      setTimeout(() => setSuccessMessage(null), 5000);\n    }\n  }, [message]);\n\n  // Clear error messages when user starts typing\n  useEffect(() => {\n    if (error && (title.length > 0 || content.length > 0)) {\n      setError(null);\n    }\n  }, [title, content, error]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ctrl/Cmd + Enter to submit dream\n      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && canCreate && isValidInput && !isCreating) {\n        e.preventDefault();\n        handleCreateDream();\n      }\n      // Escape to clear form\n      if (e.key === 'Escape' && !isCreating) {\n        setTitle(\"\");\n        setContent(\"\");\n        setError(null);\n        setSuccessMessage(null);\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [canCreate, isValidInput, isCreating, handleCreateDream]);\n\n  const handleDecryptDream = useCallback(\n    (dreamId: bigint) => {\n      const dream = dreams.find((d) => d.id === dreamId);\n      if (dream?.decryptedContent) {\n        // Toggle display\n        setShowDecrypted((prev) => ({\n          ...prev,\n          [dreamId.toString()]: !prev[dreamId.toString()],\n        }));\n      } else {\n        // Decrypt\n        decryptDream(dreamId);\n        setShowDecrypted((prev) => ({\n          ...prev,\n          [dreamId.toString()]: true,\n        }));\n      }\n    },\n    [dreams, decryptDream]\n  );\n\n  if (!isConnected) {\n    return (\n      <div className=\"mx-auto w-full max-w-2xl mt-10\">\n        <div className=\"glass-card rounded-2xl p-10 text-center border border-white/10\">\n          <h2 className=\"text-4xl font-bold mb-6 text-white text-glow\">\n             Welcome to Dream Journal\n          </h2>\n          <p className=\"text-purple-200/80 text-lg mb-10 leading-relaxed\">\n            Connect your wallet to enter your private dream sanctuary. \n            All your thoughts are fully homomorphically encrypted on-chain, \n            ensuring they remain yours and yours alone.\n          </p>\n          <div className=\"flex justify-center transform hover:scale-105 transition-transform duration-300\">\n            <ConnectButton />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Display FHEVM error if present\n  if (fhevmError && fhevmStatus === \"error\") {\n    return (\n      <div className=\"mx-auto w-full max-w-2xl mt-10\">\n        <div className=\"bg-red-950/30 backdrop-blur-md border border-red-500/30 rounded-2xl p-8\">\n          <h2 className=\"text-2xl font-bold mb-4 text-red-400\">\n            FHEVM Initialization Error\n          </h2>\n          <p className=\"text-red-300/80 mb-6\">\n            {fhevmError.message}\n          </p>\n          <button\n            onClick={() => window.location.reload()}\n            className=\"px-6 py-2 bg-red-600/80 hover:bg-red-600 text-white rounded-xl transition-colors shadow-lg shadow-red-900/20\"\n          >\n            Reload Sanctuary\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Network validation is handled above in isCorrectNetwork memo\n  \n  if (!isCorrectNetwork && chainId !== undefined) {\n    return (\n      <div className=\"mx-auto w-full max-w-2xl mt-10\">\n        <div className=\"bg-amber-950/30 backdrop-blur-md border border-amber-500/30 rounded-2xl p-8\">\n          <h2 className=\"text-2xl font-bold mb-4 text-amber-400\">\n            Wrong Realm Detected\n          </h2>\n          <p className=\"text-amber-200/80 mb-6\">\n            Please switch to <strong>Hardhat Local</strong> (31337) or <strong>Sepolia</strong> (11155111).\n          </p>\n          <div className=\"flex justify-start\">\n            <ConnectButton />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (isDeployed === false) {\n    return errorNotDeployed(chainId);\n  }\n\n  return (\n    <div className=\"w-full max-w-5xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-1000\">\n      {/* Header Info */}\n      <div className=\"glass-card rounded-2xl p-6 flex flex-col md:flex-row justify-between items-center gap-4\">\n        <div className=\"flex flex-col gap-1\">\n          <h2 className=\"text-xl font-bold text-white tracking-wide\">Sanctuary Status</h2>\n          <div className=\"flex flex-wrap gap-3 text-xs font-medium\">\n            <span className=\"px-2 py-1 bg-purple-500/10 text-purple-300 rounded-md border border-purple-500/20\">\n              User: {address?.slice(0, 6)}...{address?.slice(-4)}\n            </span>\n            {dreams.length > 0 && (\n              <span className=\"px-2 py-1 bg-indigo-500/10 text-indigo-300 rounded-md border border-indigo-500/20\">\n                Total Dreams: {dreams.length}\n              </span>\n            )}\n          </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          {message && (\n            <span className=\"text-sm font-medium text-purple-300 animate-pulse\">{message}</span>\n          )}\n          <ConnectButton />\n        </div>\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-8\">\n        {/* Create Dream Form - Left Column */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          <div className=\"glass-card rounded-2xl p-6 sticky top-8\">\n            <h3 className=\"text-xl font-bold mb-6 text-white border-b border-white/5 pb-4\">\n              New Dream Entry\n            </h3>\n            <div className=\"space-y-5\">\n              <div>\n                <label className=\"block text-xs font-bold text-purple-300/60 uppercase tracking-widest mb-2 ml-1\">\n                  Dream Title\n                </label>\n                <input\n                  type=\"text\"\n                  value={title}\n                  onChange={(e) => setTitle(sanitizeInput(e.target.value))}\n                  placeholder=\"The Flying Castle...\"\n                  className=\"w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all outline-none text-white placeholder:text-white/20\"\n                  disabled={isCreating}\n                  maxLength={200}\n                />\n                <div className=\"mt-2 text-[10px] text-right text-white/40 font-mono\">\n                  {title.length}/200\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-xs font-bold text-purple-300/60 uppercase tracking-widest mb-2 ml-1\">\n                  Dream Content\n                </label>\n                <textarea\n                  value={content}\n                  onChange={(e) => setContent(sanitizeInput(e.target.value))}\n                  placeholder=\"It started in a valley of shadows...\"\n                  rows={6}\n                  className=\"w-full px-4 py-3 bg-black/30 border border-white/10 rounded-xl focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all outline-none text-white placeholder:text-white/20 resize-none\"\n                  disabled={isCreating}\n                  maxLength={10000}\n                />\n                <div className=\"mt-2 flex justify-between items-center text-[10px] font-mono\">\n                  <span className=\"text-purple-300/40 italic\">FHE Encrypted Locally</span>\n                  <span className=\"text-white/40\">{content.length}/10,000</span>\n                </div>\n              </div>\n\n              <button\n                onClick={handleCreateDream}\n                disabled={!canCreate || !isValidInput}\n                className=\"group relative w-full px-6 py-4 bg-gradient-to-br from-purple-600 to-indigo-700 text-white font-bold rounded-xl shadow-xl shadow-purple-950/40 hover:shadow-purple-500/20 transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed overflow-hidden\"\n              >\n                <div className=\"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300\"></div>\n                <span className=\"relative z-10\">\n                  {isCreating ? (\n                    <span className=\"flex items-center justify-center gap-2\">\n                      <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                      Encrypting...\n                    </span>\n                  ) : \"Commit to Blockchain\"}\n                </span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Dreams List - Right Column */}\n        <div className=\"lg:col-span-3 space-y-6\">\n          <div className=\"glass-card rounded-2xl p-6 min-h-[500px]\">\n            <div className=\"flex justify-between items-center mb-8 border-b border-white/5 pb-4\">\n              <h3 className=\"text-xl font-bold text-white tracking-tight\">\n                Dream Archive\n              </h3>\n              <button\n                onClick={() => {\n                  setIsRefreshing(true);\n                  loadDreams().finally(() => setIsRefreshing(false));\n                }}\n                disabled={!canLoadDreams || isLoading || isRefreshing}\n                className=\"p-2 bg-white/5 hover:bg-white/10 text-white/60 hover:text-white rounded-lg transition-all disabled:opacity-30\"\n                title=\"Refresh Archive\"\n              >\n                <svg className={`w-5 h-5 ${isRefreshing ? 'animate-spin' : ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n              </button>\n            </div>\n\n            {dreams.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-20 text-center\">\n                <div className=\"w-16 h-16 bg-purple-500/10 rounded-full flex items-center justify-center mb-4 border border-purple-500/20\">\n                  <span className=\"text-3xl text-purple-400\"></span>\n                </div>\n                <p className=\"text-white/60 font-medium italic\">Your archive is empty</p>\n                <p className=\"text-white/30 text-sm mt-1\">First dream is waiting to be captured</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 gap-4\">\n                {dreams.map((dream) => (\n                  <div\n                    key={dream.id.toString()}\n                    className=\"group bg-white/[0.02] hover:bg-white/[0.05] border border-white/5 hover:border-purple-500/30 rounded-2xl p-5 transition-all duration-300\"\n                  >\n                    <div className=\"flex justify-between items-center gap-4\">\n                      <div className=\"space-y-1\">\n                        <h4 className=\"font-bold text-white text-lg group-hover:text-purple-300 transition-colors\">\n                          {dream.title}\n                        </h4>\n                        <div className=\"flex items-center gap-3 text-[11px] text-white/40 font-medium\">\n                          <span className=\"flex items-center gap-1\">\n                            <svg className=\"w-3 h-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                            </svg>\n                            {new Date(Number(dream.createdAt) * 1000).toLocaleDateString()}\n                          </span>\n                          <span className=\"w-1 h-1 bg-white/20 rounded-full\"></span>\n                          <span className=\"uppercase tracking-widest text-purple-400/60\">ID: {dream.id.toString()}</span>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => handleDecryptDream(dream.id)}\n                        disabled={dream.isDecrypting || isLoading}\n                        className={`px-4 py-2 text-xs font-bold rounded-xl transition-all duration-300 ${\n                          dream.decryptedContent && showDecrypted[dream.id.toString()]\n                          ? \"bg-white/10 text-white border border-white/20\"\n                          : \"bg-purple-600/20 hover:bg-purple-600/40 text-purple-300 border border-purple-500/30\"\n                        }`}\n                      >\n                        {dream.isDecrypting ? (\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-3 h-3 border-2 border-purple-300/30 border-t-purple-300 rounded-full animate-spin\"></div>\n                            Decrypting\n                          </div>\n                        ) : dream.decryptedContent && showDecrypted[dream.id.toString()] ? \"Hide Content\" : \"Decrypt View\"}\n                      </button>\n                    </div>\n                    \n                    {dream.decryptedContent && showDecrypted[dream.id.toString()] && (\n                      <div className=\"mt-4 p-5 bg-purple-950/20 rounded-xl border border-purple-500/10 animate-in fade-in zoom-in-95 duration-500\">\n                        <div className=\"text-xs font-bold text-purple-400/60 uppercase tracking-widest mb-3 flex items-center gap-2\">\n                          <span className=\"w-2 h-2 bg-purple-500 rounded-full animate-pulse\"></span>\n                          Decrypted Thought\n                        </div>\n                        <p className=\"text-purple-100/90 leading-relaxed whitespace-pre-wrap selection:bg-purple-500/30\">\n                          {dream.decryptedContent}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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","debugId":null}}]
}